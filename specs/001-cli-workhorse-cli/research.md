# Research: CLI 应用基础架构

## 1. CLI 帮助信息格式研究

### 结论
通过分析 `git`, `gh`, `nvm`, `brew` 等流行工具，总结出高效的 `--help` 输出应遵循以下结构：

1.  **概要 (Usage)**: 简明扼要地展示命令的基本语法结构。
    - `workhorse [command] [options]`
2.  **描述 (Description)**: 一两句话描述 CLI 的核心用途。
3.  **命令列表 (Commands)**: 列出所有可用的子命令及其简短描述。
4.  **选项列表 (Options)**: 列出全局选项，如 `--help`, `--version`。应包含短格式和长格式（如 `-h`, `--help`）。
5.  **示例 (Examples)**: 提供 1-2 个最常见的用例作为示例，帮助用户快速上手。
6.  **更多帮助**: 指引用户到更详细的文档或网站。

### 理由
此结构清晰、分层，能让用户快速找到所需信息。它首先展示最核心的用法，然后逐步展开细节，符合用户由浅入深的认知习惯。

### 备选方案
- **极简模式**: 只提供命令列表，不提供描述和示例。
- **拒绝理由**: 对于新用户不够友好，学习曲线陡峭。

---

## 2. Node.js CLI 框架选择

### 决策: `commander.js`
选择 `commander.js` 作为此项目的命令行解析框架。

### 理由
- **轻量且成熟**: `commander.js` 是一个久经考验的库，API 稳定，社区庞大，能满足本项目当前及未来可预见的需求。
- **易于上手**: 其 API 设计直观，可以快速定义命令、选项和帮助信息。
- **自动生成帮助信息**: 能根据定义的命令和选项自动生成格式良好的帮助文档，与我们的研究结论格式非常吻合。
- **与技术栈兼容**: 作为一个纯粹的 Node.js 库，与 TypeScript 和 Vite 的集成没有兼容性问题。

### 备选方案
- **`yargs`**: 功能比 `commander.js` 更强大，但对于当前项目而言，其复杂性是不必要的。
- **`oclif`**: 一个更全面的框架（由 Heroku 开发），它约定了项目结构。虽然强大，但对于我们这个需要与现有结构和 Vite 集成的项目来说，灵活性稍差。

---

## 3. 使用 Vite 打包 Node.js CLI

### 决策
我们将使用 Vite 来编译 TypeScript 代码，但最终的打包和可执行文件创建将依赖 `pkg` 或 `esbuild`。Vite 主要用于开发和测试阶段。

### 理由
- **开发效率**: Vite 的快速重载和 HMR（热模块替换）能力在开发阶段非常有用，尤其是在调试命令逻辑时。Vitest 测试框架与 Vite 无缝集成，提供了优秀的测试体验。
- **关注点分离**: Vite 的核心优势在于前端构建。对于后端或 CLI 应用，虽然可以利用其 TS 编译和开发服务器，但将其打包成一个独立的、跨平台的可执行文件并非其设计初衷。
- **专用工具**: `pkg` 或 `esbuild` 等工具专门用于将 Node.js 应用打包成单文件可执行程序，它们能更好地处理原生依赖、文件系统路径等 CLI 应用特有的问题。

### 备选方案
- **仅使用 `tsc`**: 使用 TypeScript 编译器将代码编译成 JavaScript，然后手动运行。
- **拒绝理由**: 缺少开发过程中的热重载和现代化的测试体验，开发效率较低。
